<div class="container">
    <div class="global">
	<!--           BREADCRUMBS           -->
	<div class="homelink">
		<p>{{datastore.Name}}</p>
		<span class="breadcrumbs-divider">|</span>    
		<p class="add" (click)="varform=1">+ Add PostgreSQL database</p>
		<span class="breadcrumbs-divider">|</span>    
		<p class="add" (click)="varform=2">+ Add MongoDB database</p>
		<span class="breadcrumbs-divider">|</span>
		<p class="add" (click)="varform=3">+ Add structured file</p>
		<span class="breadcrumbs-divider">|</span>
		<p class="add" (click)="varform=4">+ Add unstructured file</p>
		<span class="breadcrumbs-divider">|</span>
		<button (click)="closeDatastore()" class="close">x Close datastore</button>
	</div> 
	<div class="annotation-list">
	<!--           Annotations panel           -->
		<p class="add-annotation" (click)="varform=1.5">+ New annotation</p>
		<span class="breadcrumbs-divider">|</span>		
		<p class="add-annotation" (click)="varform=2.5"> Assign annotation to file</p>
		<span class="breadcrumbs-divider">|</span>
		<p class="add-annotation" (click)="varform=3.5"> Manage annotations</p>
	</div>
	<!--           Form to add annotations           -->
	<form [formGroup]="annotationForm" (ngSubmit)="addAnnotation()"  *ngIf="varform === 1.5">
      		<input  type="text" placeholder="Description" formControlName="Description">
		<button [disabled]="annotationForm.pristine || annotationForm.invalid"> Add annotation </button>
	</form>
	<!--           Form to assign annotation to file           -->
    	<form [formGroup]="annotationBaseForm" (ngSubmit)="addAnnotationBase()"  *ngIf="varform === 2.5">
		<select name="annotations" formControlName="BaseId">
			<ng-container *ngFor="let str of datastore.StructuredFiles; let i=index;">
				<ng-container *ngFor="let unstr of datastore.UnstructuredFiles; let i=index;">
				  	<option [value]="unstr.Id">{{unstr.FilePath}}</option>  
				  	<option [value]="str.Id">{{str.FilePath}}</option>
				</ng-container>
			</ng-container>
		</select> 
		<select name="annotations" formControlName="AnnotationId">
			<ng-container *ngFor="let a of annotations; let i=index;">
			  	<option [value]="a.Id">{{a.Description}}</option>  
			</ng-container>
		</select> 
		<button [disabled]="annotationBaseForm.pristine || annotationBaseForm.invalid"> Assign annotation</button>
	</form>
	<div class="annotation-list-manage">
	<!--           Display all annotations          -->
		<ng-container  *ngIf="varform === 3.5">
			<p>List of annotations</p>
			<ng-container *ngFor="let a of annotations; let i=index;">
					<p class="annotation-manage" (click)="varform=2.5"> {{a.Description}}|<button (click)="deleteAnnotation(a.Id)" class="delete-annotation"> Delete </button></p>
			</ng-container>
		</ng-container>
	</div>
	<!--           Form to add postgres db           -->
	 <form [formGroup]="postgresDatabaseForm" (ngSubmit)="addPostgresDatabase()" *ngIf="varform === 1">
		<input  type="text" placeholder="PostgreSQL database name" formControlName="Name">
		<button [disabled]="postgresDatabaseForm.pristine || postgresDatabaseForm.invalid"> Add PostgreSQL </button>
	 </form>
	<!--           Form to add mongo db           -->
	 <form [formGroup]="mongoDatabaseForm" (ngSubmit)="addMongoDatabase()" *ngIf="varform === 2">
		<input  type="text" placeholder="MongoDB database name" formControlName="Name">
		<button [disabled]="mongoDatabaseForm.pristine || mongoDatabaseForm.invalid"> Add MongoDB </button>
	 </form>

	<!--           Form to add structured file           -->
	 <form [formGroup]="structFileForm" (ngSubmit)="addStructFile()" *ngIf="varform === 3">
		<input  type="text" placeholder="Structured file path" formControlName="FilePath">
		<button [disabled]="structFileForm.pristine || structFileForm.invalid"> Add File </button>
	 </form>

	<!--           Form to add unstructured file           -->
	 <form [formGroup]="unstructFileForm" (ngSubmit)="addUnstructFile()" *ngIf="varform === 4">
		<input  type="text" placeholder="Unstructured file path" formControlName="FilePath">
		<button [disabled]="unstructFileForm.pristine || unstructFileForm.invalid"> Add File </button>
	 </form>
	<!--           Display postgres db           -->
	<div *ngFor="let db of postgresDatabases; let i=index;">
			<div *ngIf="db.DatastoreId==datastore.Id">
				<h2>[{{db.Type}}] {{db.Name}} <span class="breadcrumbs-divider"> | </span> <button (click)="toPostgresDatabase(datastore.Id, db.Id)">View</button></h2>
	<!--           Display postgres schemas          -->
				<div *ngFor="let s of db.Schemas; let j=index;">
					<p class="schema-name">{{s.Name}} <span class="breadcrumbs-divider"> | </span> <button (click)="toPostgresSchema(datastore.Id, db.Id, s.Id)">View</button></p>
	<!--           Display postgres tables and fields          -->
					<div class="table-list">
						<ng-container *ngFor="let t of tables; let k=index;">
							<div *ngIf="t.SchemaId==s.Id" class="table">
								<p class="table-name">[{{t.Id}}] {{t.Name}}</p>
								<div *ngFor="let f of t.Fields; let l=index;">
									<div class="table-fields">        
									    <p class="field-id"> {{f.Id}}</p>
									    <p class="field-name"> {{f.Name}}, </p>
									    <p class="field-type"> {{f.Type}}, </p>
					<ng-container *ngFor="let k of keyRelationships; let n=index;">
						<ng-container *ngFor="let t2 of tables; let n=index;">
								<ng-container *ngFor="let f2 of t2.Fields; let j=index;">
				    					<div class="rel-to" *ngIf="k.ToId==f.Id  && f2.Id==k.FromId && t2.Id==f2.StructuredId">FK from {{t2.Name}}:{{f2.Name}}</div>
								</ng-container>
						</ng-container>
					</ng-container>
									</div>	
								</div>
							</div>
						</ng-container>
					</div>
				</div>
			</div>
	</div>
	<!--           Display mongo db           -->
	<div *ngFor="let mdb of mongoDatabases; let i=index;">
		<div *ngIf="mdb.DatastoreId==datastore.Id">
			<h2>[{{mdb.Type}}] {{mdb.Name}} <span class="breadcrumbs-divider"> | </span> <button (click)="toMongoDatabase(datastore.Id, mdb.Id)">View</button></h2>
	<!--           Display mongo collections           -->
			<div class="table-list">
				<ng-container *ngFor="let c of collections; let i=index;">
					<div *ngIf="c.DatabaseId==mdb.Id" class="table">
						<p class="table-name">[{{c.Id}}] {{c.Name}}</p>
						<div *ngFor="let f of c.Fields; let j=index;">
							<div class="table-fields">        
							    <p class="field-id"> {{f.Id}}</p>
							    <p class="field-name"> {{f.Name}}, </p>
							    <p class="field-type"> {{f.Type}}, </p>
							</div>	
						</div>
					</div>
				</ng-container>
			</div>
		</div>
	</div>

	<!--           Display structured files           -->
	<div *ngFor="let str of datastore.StructuredFiles; let h=index;">
		<div class="file">
			<h2 class="file-title"> Structured File | <button (click)="deleteStructFile(str.Id)">Delete</button></h2>
			<ng-container *ngFor="let ab of annotationBases; let i=index;">
				<ng-container *ngFor="let a of annotations; let i=index;">
					<ng-container *ngIf="str.Id===ab.BaseId && ab.AnnotationId===a.Id">
						<p class="file-annotation"> {{a.Description}} |<button (click)="deleteAnnotationBase(ab.Id)" class="delete-annotation">Remove</button></p>		
					</ng-container>
				</ng-container>
			</ng-container>
			<p class="file-path">{{str.FilePath}}</p>
		</div>
    	</div>
	<!--           Display unstructured files           -->
	<div *ngFor="let unstr of datastore.UnstructuredFiles; let h=index;">
		<div class="file">
			<h2 class="file-title"> Untructured File | <button (click)="deleteUnstructFile(unstr.Id)">Delete</button></h2>
			<ng-container *ngFor="let ab of annotationBases; let i=index;">
				<ng-container *ngFor="let a of annotations; let i=index;">
					<ng-container *ngIf="unstr.Id===ab.BaseId && ab.AnnotationId===a.Id">
						<p class="file-annotation"> {{a.Description}} |<button (click)="deleteAnnotationBase(ab.Id)" class="delete-annotation">Remove</button></p>		
					</ng-container>
				</ng-container>
			</ng-container>
			<p class="file-path">{{unstr.FilePath}}</p>
		</div>
    	</div>

    </div>
</div>


